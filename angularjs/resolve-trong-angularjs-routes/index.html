<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="google-site-verification" content="vy14mO9wf2bjKiZs8BIxCFXKJDP40DqGTqiwxscMctw" />
<title>Hiểu về 'Resolve' trong AngularJS routes &#8211; THAPSANG.NET</title>
<meta name="description" content="Giải thích về thuộc tính 'resolve' trong $routeProvider của module ngRoute.">
<meta name="keywords" content="ngRoute, resolve, angularjs">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://thapsang.net/images/my-candle.png">
<meta name="twitter:title" content="Hiểu về 'Resolve' trong AngularJS routes">
<meta name="twitter:description" content="Giải thích về thuộc tính 'resolve' trong $routeProvider của module ngRoute.">
<meta name="twitter:creator" content="@taly2808">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Hiểu về 'Resolve' trong AngularJS routes">
<meta property="og:description" content="Giải thích về thuộc tính 'resolve' trong $routeProvider của module ngRoute.">
<meta property="og:url" content="http://thapsang.net/angularjs/resolve-trong-angularjs-routes">
<meta property="og:site_name" content="THAPSANG.NET">
<meta property="og:image" content="http://thapsang.net/images/my-candle.png">





<link rel="canonical" href="http://thapsang.net/angularjs/resolve-trong-angularjs-routes">
<link href="http://thapsang.net/feed.xml" type="application/atom+xml" rel="alternate" title="THAPSANG.NET Feed">
<link rel="author" href="https://plus.google.com/+TaLy2808?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="http://thapsang.net/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="http://thapsang.net/assets/css/style.css" />

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search...">
        <i class="icon-remove-sign"></i>
        <ul class="search-results post-list"></ul><!-- /.search-results -->
    </div><!-- /.search-form -->
</div><!-- ./search-wrapper -->




<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://thapsang.net/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://thapsang.net/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://thapsang.net/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://thapsang.net/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://thapsang.net/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://thapsang.net/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  
<div id="fade"></div>
<a id="slide" class="animated fade"></a>
<aside id="sidebar">
    <nav id="navigation">
    <h2>MENU</h2>
    <hr>

            <li>
                    <a href="http://thapsang.net/">Trang bìa</a>
                 </li>

            <li>
                    <a href="http://thapsang.net/categories">Danh mục</a>
                 </li>

            <li>
                    <a href="http://thapsang.net/tags"><i class="icon-tag"></i> Tags</a>
                 </li>

            <li>
                    <a href="http://thapsang.net/about">Giới thiệu</a>
                 </li>
            
           <li><a href="https://feedburner.google.com/fb/a/mailverify?uri=thapsangnet/taly2808&amp;loc=en_US" title="Atom/RSS feed" target="_blank"><i class="icon-rss"></i> Feed</a></li>
    </nav>
    
    
</aside>

<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(http://thapsang.net/images/picture-2.jpg)" itemscope itemtype="http://schema.org/Organization">


    <button class="menu-button animated fade dosearch">
        <i class="icon-search"></i>
    </button>


    <div class="inner">
        <div class="container">
            <a class="brand" href="http://thapsang.net/" role="banner" itemprop="url">

                <img itemprop="logo" src="http://thapsang.net/images/my-candle.png" alt="THAPSANG.NET Logo" />

            <h1 class="blog-title light" itemprop="name">
                THAPSANG.NET
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
            <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

            <path class="medium left" d="M0 100 L50 50 L0 33.3" fill="rgba(255,255,255, .3)"></path>
            <path class="medium right" d="M100 100 L50 50 L100 33.3" fill="rgba(255,255,255, .3)"></path>

            <path class="small left" d="M0 100 L50 50 L0 66.6" fill="rgba(255,255,255, .5)"></path>
            <path class="small right" d="M100 100 L50 50 L100 66.6" fill="rgba(255,255,255, .5)"></path>

            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>

<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-10 col-md-offset-1 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
            
            
            
            
            
                    <header class="post-header entry-header">
                    
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">Hiểu về 'Resolve' trong AngularJS routes</h1>
                        
                        <div class="cursive" style="color: #000; font-style:italic;">Giải thích về thuộc tính 'resolve' trong $routeProvider của module ngRoute.</div>
                        <div class="post-info text-center small">
                            <span class="entry-date date published updated"><time datetime="2014-10-28T00:00:00+07:00" class="post-time" itemprop="datePublished">28 Oct 2014</time><span>
                            in <span class="post-tags"><a href="http://thapsang.net/categories/index.html#angularjs" data-toggle="tooltip" title="Other posts from the Angularjs category" rel="tag">Angularjs</a></span>&nbsp;<span class="post-tags"><i class="icon-time"></i>&nbsp;<span class="time">20.35</span> minutes read</span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <p>Trong bài <a href="/angularjs/tim-hieu-module-ngRoute-trong-angularjs">Tìm hiểu module ngRoute trong AngularJS</a>, chúng ta đã tìm hiểu cách làm thế nào để định tuyến (routing) và cách các routes nói chuyện với controller như thế nào. Việc khởi tạo các controller có thể khác nhau dựa trên các thiết lập của route và các sự kiện <code>$routeChangeSuccess</code> và <code>$routeChangeError</code> tương ứng. Hầu hết các sự kiện này có do thuộc tính <code>resolve</code> khi cấu hình route. Trong bài này, chúng ta sẽ làm sáng rõ vấn đề Tại sao lại cần <code>resolve</code> và cách thức hoạt động của nó như thế nào.</p>

<p>Tôi tìm được một bài viết của <a href="http://www.twitter.com/shidhincr">Shidhin</a> giải thích khá rõ ràng và dễ hiểu về thuộc tính <a href="http://www.undefinednull.com/2014/02/17/resolve-in-angularjs-routes-explained-as-story/">‘Resolve’ trong AngularJS routes</a> thông qua ba phiên bản của một câu chuyện. Do đó, tôi sẽ dịch lại bài viết đó và giữ nguyên câu chuyện của tác giả để lưu lại kiến thức cho bản thân và chia sẻ bài viết bổ ích này tới các bạn quan tâm.</p>

<section>
  <header>
    <h2>Nội dung</h2>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#cu-chuyn">Câu chuyện</a></li>
  <li><a href="#phin-bn-2-ca-cu-chuyn">Phiên bản 2 của câu chuyện</a></li>
  <li><a href="#phin-bn-3-ca-cu-chuyn">Phiên bản 3 của câu chuyện</a></li>
  <li><a href="#ti-liu-tham-kho">Tài liệu tham khảo</a></li>
</ul>

  </div>
</section>

<h2 id="cu-chuyn">Câu chuyện</h2>

<p>Vào một ngày đẹp trời, tôi đã lên kế hoạch du lịch Thụy Sĩ. Vì vậy tôi gọi điện cho điều hành tour. Anh ta giải thích cho tôi về hành trình và thông tin khách sạn rất chi tiết và rõ ràng, vì vậy tôi đã đề nghị anh ta chuẩn bị các thứ cần thiết. Sau đó, điều hành tour có trách nhiệm đặt phòng và thực hiện các yêu cầu cần thiết cho chuyến du lịch của tôi. Sau cùng, tôi đã có một chuyến du lịch đến Thụy Sĩ.</p>

<p>Bây giờ, chúng ta chuyển câu chuyện này sang ngữ cảnh của AngularJS. Chúng ta có:</p>

<ul>
  <li><code>visitplace</code> là route đầu tiên của chúng ta.</li>
  <li>Địa điểm, các khu vực lân cận, phòng khách sạn là các nội dung trong template. Chúng ta sẽ thêm chúng vào trong file <code>placetovisit.html</code>.</li>
  <li>Điều hành tour là người kết nối tới địa điểm, do đó chúng ta có một controller tên là <code>TourCoordinatorCtrl</code>.</li>
</ul>

<p>Nội dung của file <code>app.js</code> như sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ngRoute&quot;</span><span class="p">]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$routeProvider</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s2">&quot;/visitplace&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">templateUrl</span><span class="o">:</span> <span class="s2">&quot;placetovisit.html&quot;</span><span class="p">,</span>
    <span class="nx">controller</span><span class="o">:</span> <span class="s2">&quot;TourCoordinatorCtrl&quot;</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s2">&quot;accommodation&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">hotelName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;Some Hotel&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">roomNo</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">&quot;203&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;TourCoordinatorCtrl&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">accommodation</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Shidhin&quot;</span><span class="p">;</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">place</span> <span class="o">=</span> <span class="s2">&quot;Switzerland&quot;</span><span class="p">;</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">hotel</span> <span class="o">=</span> <span class="nx">accommodation</span><span class="p">.</span><span class="nx">hotelName</span><span class="p">();</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">roomno</span> <span class="o">=</span> <span class="nx">accommodation</span><span class="p">.</span><span class="nx">roomNo</span><span class="p">();</span>
<span class="p">});</span></code></pre></div>

<p>Template <code>placetovisit.html</code>:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;h1&gt;</span>Trip details<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div&gt;</span>
  <span class="nt">&lt;h2&gt;</span>Hi, {{name}}. Welcome to {{place}}<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;div&gt;</span>The accomodation is arranged on <span class="nt">&lt;strong&gt;</span>{{hotel}}<span class="nt">&lt;/strong&gt;</span> and room number is <span class="nt">&lt;strong&gt;</span>{{roomno}}<span class="nt">&lt;/strong&gt;&lt;/div&gt;</span>    
<span class="nt">&lt;/div&gt;</span></code></pre></div>

<p>Và file <code>index.html</code>:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span> <span class="na">ng-app=</span><span class="s">&quot;app&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>AngularJS Resolve routes example<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://code.angularjs.org/1.2.25/angular.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://code.angularjs.org/1.2.25/angular-route.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#/visitplace&quot;</span><span class="nt">&gt;</span>I want to go for a trip<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">ng-view</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span></code></pre></div>

<iframe src="http://embed.plnkr.co/Wc1bDmZluHBxztDWMEPM/preview" style="border:0px #FFFFFF none;" name="'Resolve' in AngularJs routes v1" scrolling="no" frameborder="1" marginheight="0px" marginwidth="0px" height="250px" width="100%"></iframe>

<p>Mọi thứ diễn ra như mong đợi khi chúng ta đìều hướng đến route <code>/visitplace</code>. Ở đây, chúng ta thấy rằng <code>TourCoordinatorCtrl</code> phụ thuộc vào <code>accommodation</code> service. Controller chỉ chịu trách nhiệm tìm chi tiết khách sạn và phòng. Ngoài ra, việc lấy chi tiết về khách sạn và phòng là các sự kiện hoàn toàn đồng bộ. Điều đó có nghĩa là căn phòng sẽ được bố trí trước khi tôi tới nơi.</p>

<p>Nhưng điều gì sẽ xảy ra nếu các sự kiện là không đồng bộ? Hãy nghĩ theo hướng này: Điều gì xảy ra nếu điều hành tour không chuyên nghiệp và anh ta đã quên đặt phòng và khách sạn? Do đó, khi tôi tới nơi tôi sẽ phải chờ cho tới khi tôi lấy được một phòng mới. Tương tự như vậy, trong code, chúng ta có thể thấy rằng view sẽ được trả lại (render) nhưng phương thức <code>getHotel()</code> và <code>getRoom()</code> sẽ lấy thêm thời gian để có được thông tin chi tiết phòng.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ngRoute&quot;</span><span class="p">]);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$routeProvider</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s2">&quot;/visitplace&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">templateUrl</span><span class="o">:</span> <span class="s2">&quot;placetovisit.html&quot;</span><span class="p">,</span>
    <span class="nx">controller</span><span class="o">:</span> <span class="s2">&quot;TourCoordinatorCtrl&quot;</span>
  <span class="p">});</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s2">&quot;accommodation&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$timeout</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">hotelName</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">scope</span><span class="p">.</span><span class="nx">hotel</span> <span class="o">=</span> <span class="s2">&quot;Some hotel&quot;</span><span class="p">;</span>
      <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
      <span class="k">return</span> <span class="s2">&quot;---&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">roomNo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">scope</span><span class="p">.</span><span class="nx">roomno</span> <span class="o">=</span> <span class="s2">&quot;103&quot;</span><span class="p">;</span>
      <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
      <span class="k">return</span> <span class="s2">&quot;---&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;TourCoordinatorCtrl&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">accommodation</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Shidhin&quot;</span><span class="p">;</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">place</span> <span class="o">=</span> <span class="s2">&quot;Switzerland&quot;</span><span class="p">;</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">hotel</span> <span class="o">=</span> <span class="nx">accommodation</span><span class="p">.</span><span class="nx">hotelName</span><span class="p">(</span><span class="nx">$scope</span><span class="p">);</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">roomno</span> <span class="o">=</span> <span class="nx">accommodation</span><span class="p">.</span><span class="nx">roomNo</span><span class="p">(</span><span class="nx">$scope</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<p>Đây không phải là một ý tưởng tốt. Chúng ta phải trả lại view và đợi dữ liệu được nạp lên đó. Trong trường hợp của tôi, nó giống như việc tôi đã bắt đầu chuyến đi và đã đến nơi, nhưng tôi đang phải chờ đợi ở đó để có được nơi ăn nghỉ của mình. Điều này thực sự gây khó chịu và phiền nhiễu. Liệu có cách nào có thể đảm bảo rằng các phụ thuộc kia được giải quyết trước khi tôi bắt đầu chuyến đi của mình? Hãy xem:</p>

<h2 id="phin-bn-2-ca-cu-chuyn">Phiên bản 2 của câu chuyện</h2>

<p>Tôi có một người bạn, cậu ta là chủ một khách sạn tại Thụy Sĩ. Cậu ta là bạn rất thân của tôi, vì vậy tôi có thể đề nghị cậu ta để cho tôi một phòng bất cứ lúc nào. Nếu tôi làm như vậy thì tôi không còn phải phụ thuộc vào nơi ở do điều hành tour cung cấp nữa. Cuối cùng, tất cả những gì tôi phải làm là đảm bảo chắc chắn rằng bản thân tôi giải quyết được vấn đề chỗ ở và thông báo với điều hành tour thu xếp các vấn đề còn lại.</p>

<p>Đây chính xác là những gì chúng ta cần nếu bản thân các routes cần giải quyết các phụ thuộc trong ứng dụng. Với vấn đề này, Angular cung cấp một thuộc tính <code>resolve</code> trong cấu hình của dịch vụ <code>$routeProvider</code>. Thuộc tính resolve là một đối tượng sơ đồ tùy chọn (an optional map object) hoặc một mảng tên các dịch vụ hiện có (array of existing service names). Tất cả các keys của map object có thể được bơm truyền vào controller như một phụ thuộc. Key là một chuỗi (string) đơn giản, và giá trị của nó có thể là một function hoặc một string. Nếu giá trị là string thì Angular sẽ xem đó là một dịch vụ hiện có (existing service) và bơm truyền vào controller. Nếu giá trị là một function thì nó sẽ hoạt động như một factory function và giá trị trả về sẽ được bơm truyền vào controller.</p>

<p>Hãy liên hệ câu chuyện hiện tại với ngữ cảnh của Angular bằng cách sử dụng đối tượng <code>resolve</code>. Hãy xem những thay đổi trong code của ứng dụng, file <code>app.js</code>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ngRoute&quot;</span><span class="p">]);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$routeProvider</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s2">&quot;/visitplace&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">templateUrl</span><span class="o">:</span> <span class="s2">&quot;placetovisit.html&quot;</span><span class="p">,</span>
    <span class="nx">controller</span><span class="o">:</span> <span class="s2">&quot;TourCoordinatorCtrl&quot;</span><span class="p">,</span>
    <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;myFriendsHotel&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">hotelName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;My Friend&#39;s hotel&quot;</span><span class="p">;</span>
          <span class="p">},</span>
          <span class="nx">roomNo</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;100&quot;</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;TourCoordinatorCtrl&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">myFriendsHotel</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Shidhin&quot;</span><span class="p">;</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">place</span> <span class="o">=</span> <span class="s2">&quot;Switzerland&quot;</span><span class="p">;</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">hotel</span> <span class="o">=</span> <span class="nx">myFriendsHotel</span><span class="p">.</span><span class="nx">hotelName</span><span class="p">();</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">roomno</span> <span class="o">=</span> <span class="nx">myFriendsHotel</span><span class="p">.</span><span class="nx">roomNo</span><span class="p">();</span>
<span class="p">});</span></code></pre></div>

<p><em>Lưu ý: Khi controller đã được định nghĩa trong route, không bao giờ khởi tạo lại nó thông qua ng-controller directive, điều đó có thể đưa ra lỗi khi sử dụng với thuộc tính resolve.</em></p>

<p>Bằng cách này, chúng ta có thể chắc chắn rằng việc khởi tạo controller sẽ bị trì hoãn cho đến khi khách sạn đã sẵn sàng. View sẽ chỉ được trả lại khi controller đã được khởi tạo và sự kiện <code>$routeChangeSuccess</code> sẽ được kích hoạt. Cũng cần chú ý rằng, việc tìm khách sạn ở đây là một hành động đồng bộ; có nghĩa là khi bạn tôi là chủ khách sạn, tôi có phòng ngay lập tức. Trong các ứng dụng thực tế, hầu hết chúng ta phải đối phó với các hành động không đồng bộ. Nào, hãy chuyển đến phiên bản thứ 3 của câu chuyện.</p>

<h2 id="phin-bn-3-ca-cu-chuyn">Phiên bản 3 của câu chuyện</h2>

<p>Trong phiên bản trước, bạn của tôi là chủ khách sạn. Nhưng trong phiên bản này, sẽ không có chủ khách sạn nào cả. Lần này, tôi có một người bạn khác ở Thụy Sĩ, cô ấy biết một vài chủ khách sạn và có thể tìm phòng cho tôi với giá rẻ hơn. Khi tôi gọi điện cho cô ấy và nói yêu cầu của mình, cô ấy sẽ mất một thời gian để nói chuyện với bạn của cô ấy và thu xếp cho tôi một phòng. Và thời gian đó không thể đoán trước được bởi vì bạn tôi sẽ yêu cầu bạn bè của cô ấy, bạn cô ấy có thể nói chuyện với bạn của họ và cứ như thế. Nhưng khi tôi gọi cho cô ấy lần đầu tiên, cô ấy hứa với tôi rằng cô ấy chắc chắn sẽ cập nhật kết quả, do đó tôi có thể thu xếp phần còn lại. Vì vậy, chỉ khi tôi nhận được thông tin cập nhật từ cô ấy, tôi mới gọi cho điều hành tour và đề nghị anh ta thu xếp các phần còn lại.</p>

<p>Hãy xem những thay đổi trong file <code>app.js</code> ở phiên bản cuối này:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ngRoute&quot;</span><span class="p">]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$routeProvider</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s2">&quot;/visitplace&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">templateUrl</span><span class="o">:</span> <span class="s2">&quot;placetovisit.html&quot;</span><span class="p">,</span>
    <span class="nx">controller</span><span class="o">:</span> <span class="s2">&quot;TourCoordinatorCtrl&quot;</span><span class="p">,</span>
    <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;accommodation&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$q</span><span class="p">,</span> <span class="nx">$timeout</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">myFriend</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
        <span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">myFriend</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span>
            <span class="nx">hotelName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="s2">&quot;My Friend&#39;s friend&#39;s hotel&quot;</span><span class="p">;</span>
            <span class="p">},</span>
            <span class="nx">roomNo</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="s2">&quot;404&quot;</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">myFriend</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;TourCoordinatorCtrl&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">accommodation</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Shidhin&quot;</span><span class="p">;</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">place</span> <span class="o">=</span> <span class="s2">&quot;Switzerland&quot;</span><span class="p">;</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">hotel</span> <span class="o">=</span> <span class="nx">accommodation</span><span class="p">.</span><span class="nx">hotelName</span><span class="p">();</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">roomno</span> <span class="o">=</span> <span class="nx">accommodation</span><span class="p">.</span><span class="nx">roomNo</span><span class="p">();</span>
<span class="p">});</span></code></pre></div>

<p>Trong đoạn code trên, các bạn thấy rằng chúng ta đã định nghĩa một biến <code>myFriend</code> bên trong hàm resolve và khởi tạo nó bằng cách sử dụng hàm <code>$q.defer()</code> là bộ thực thi Promises API trong AngularJS, được lấy cảm hứng từ <a href="https://github.com/kriskowal/q">thư viện “Q”</a> được kriskowal thực hiện. Nếu bạn không biết <em>Promises</em> là gì, bạn nên tìm hiểu về nó <a href="http://12devs.co.uk/articles/promises-an-alternative-way-to-approach-asynchronous-javascript/">tại đây</a>.</p>

<p>Những gì xảy ra ở đây là: function resolve đã tạo ra biến <code>myFriend</code> và ngay lập tức nó trả lại <code>myFriend.promise</code>. Điều này có nghĩa, chúng ta biết rằng điều gì sẽ xảy ra sau đó và <code>myFriend</code> sẽ cập nhật kết quả của hành động để trả lại lời hứa. Hành động có thể thành công hoặc thất bại. Nếu hành động thành công, lời hứa sẽ được giải quyết (resolved) với các thông tin về phòng khách sạn; nếu hành động thất bại, lời hứa sẽ bị từ chối (reject) với dữ liệu trả lại (thường là các thông báo lỗi).</p>

<p>Khi factory function trả lại một lời hứa (promise), việc khởi tạo controller sẽ bị trì hoãn cho đến khi lời hứa được giải quyết hoặc từ chối (resolved/rejected). Khi promise được giải quyết, controller sẽ được khởi tạo và dữ liệu được trả lại sẽ được bơm vào trong controller. Trong trường hợp của chúng ta thì đó là đối tượng <code>accommodation</code>; sau đó sự kiện <code>$routeChangeSuccess</code> sẽ được kích hoạt. Cũng có khả năng là promise đầu tiên trả lại một promise khác. Trong trường hợp đó, việc khởi tạo controller của chúng ta sẽ bị trì hoãn cho đến khi tất cả các promises được giải quyết. Tại bất kỳ thời điểm nào, nếu một promise bị từ chối, controller sẽ không được khởi tạo, thay vào đó là sự kiện <code>$routeChangeError</code> sẽ được kích hoạt.</p>

<p>Trong kết quả demo dưới đây, chúng ta sẽ thấy view được trả lại sau 5 giây kể từ khi click vào link “I want to go for a trip”:</p>

<iframe src="http://embed.plnkr.co/uSxECGavg6YchGkPV9tf/preview" style="border:0px #FFFFFF none;" name="'Resolve' in AngularJs routes v3" scrolling="no" frameborder="1" marginheight="0px" marginwidth="0px" height="250px" width="100%"></iframe>

<p>Thuộc tính <code>resolve</code> khá hữu ích khi chúng ta cần có một vài dữ liệu sẵn sàng trước khi khởi tạo controller và render view. Trong các ứng dụng thực tế, <code>$timeout</code> thường được thay thế bằng <code>$http</code> để tải dữ liệu từ server. Vì nó là sự kiện không đồng bộ, nên chúng ta có thể đảm bảo rằng view sẽ được trả lại với dữ liệu phù hợp.</p>

<h2 id="ti-liu-tham-kho">Tài liệu tham khảo</h2>

<ol>
  <li><a href="http://www.undefinednull.com/2014/02/17/resolve-in-angularjs-routes-explained-as-story/">‘Resolve’ in AngularJS Routes, Explained as Story</a></li>
  <li><a href="http://documentup.com/kriskowal/q">Document about Q</a></li>
</ol>

                        <br>
                        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive_bottom -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9160637159175593"
     data-ad-slot="9145112668"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
                    
                    
                    <div class="entry-tags text-center">
                    
                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="http://thapsang.net/tags/index.html#ngRoute" data-toggle="tooltip" title="Posts tagged with ngRoute" rel="tag">ngRoute</a>&nbsp;&bull;&nbsp;<a href="http://thapsang.net/tags/index.html#resolve" data-toggle="tooltip" title="Posts tagged with resolve" rel="tag">resolve</a>&nbsp;&bull;&nbsp;<a href="http://thapsang.net/tags/index.html#angularjs" data-toggle="tooltip" title="Posts tagged with angularjs" rel="tag">angularjs</a>
                    
                    </div>
                    
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        <div class="post-share text-center">
    <p class="light small">
        Share this post
    </p>
    <ul class="social-mini">
        <li>
            <a href="https://twitter.com/intent/tweet?text=&quot;Hiểu về 'Resolve' trong AngularJS routes&quot;%20http://thapsang.net/angularjs/resolve-trong-angularjs-routes%20via%20&#64;taly2808"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" data-toggle="tooltip" title="Share on Twitter" itemprop="Twitter">
                <i class="icon-twitter"></i>
            </a>
        </li>
        <li>
            <a  href="https://www.facebook.com/sharer/sharer.php?u=http://thapsang.net/angularjs/resolve-trong-angularjs-routes"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" data-toggle="tooltip" title="Share on Facebook" itemprop="Facebook">
                <i class="icon-facebook"></i>
            </a>
        </li>
        <li>
            <a href="https://plus.google.com/share?url=http://thapsang.net/angularjs/resolve-trong-angularjs-routes"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" data-toggle="tooltip" title="Share on Google plus" itemprop="GooglePlus">
                <i class="icon-google-plus"></i>
            </a>
        </li>
    </ul>
</div>
                        <div class="post-author text-center">                       
	        <img src="http://thapsang.net/images/my-ava.png" alt="Ta Ly's photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">Written by <span itemprop="name" class="fn"><a href="http://thapsang.net/about" rel="author" title="About Ta Ly" itemprop="url">Ta Ly</a></span></h4>
	    <p>Hãy thắp một ngọn nến nhỏ, thay vì nguyền rủa bóng đêm!</p>
</div>
 
                        <div id="disqus_thread"></div><!-- /#disqus_thread -->
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(http://thapsang.net/images/picture-2.jpg)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            <li>
                <a href="http://twitter.com/taly2808" data-toggle="tooltip" title="Ta Ly on Twitter" target="_blank">
                    <i class="icon-twitter"></i>
                </a>
            </li>
            <li>
                <a href="http://facebook.com/taly2808" data-toggle="tooltip" title="Ta Ly on Facebook" target="_blank">
                    <i class="icon-facebook"></i>
                </a>
            </li>
            <li>
                <a href="https://plus.google.com/+TaLy2808" data-toggle="tooltip" title="Ta Ly on Google+" target="_blank">
                    <i class="icon-google-plus"></i>
                </a>
            </li>
            
            <li>
                <a href="taly2808" data-toggle="tooltip" title="Ta Ly on LinkedIn" target="_blank">
                    <i class="icon-linkedin"></i>
                </a>
            </li>
            
            
            <li>
                <a href="http://github.com/taly2808" data-toggle="tooltip" title="Ta Ly on Github" target="_blank">
                    <i class="icon-github"></i>
                </a>
            </li>
        </ul>
            <div>
                Bản quyền nội dung thuộc về <a href="http://thapsang.net/about/">Ta Ly</a> &copy; 2014 &dash; 2015.
            </div>
            <ul class="menu-items">
            
            <li>
                
                    <a href="http://thapsang.net/"><i class="icon-home"></i></a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="http://thapsang.net/categories">Danh mục</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="http://thapsang.net/tags"><i class="icon-tag"></i> Tags</a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="http://thapsang.net/about">Giới thiệu</a>&nbsp;&bull;
                 
            </li>
            
            <li><a href="https://feedburner.google.com/fb/a/mailverify?uri=thapsangnet/taly2808&amp;loc=en_US" title="Atom/RSS feed" target="_blank"><i class="icon-rss"></i> Feed</a></li>
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">

                <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
                <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

                <path class="medium left" d="M0 0 L50 50 L0 66.6" fill="rgba(255,255,255, .3)"></path>
                <path class="medium right" d="M100 0 L50 50 L100 66.6" fill="rgba(255,255,255, .3)"></path>

                <path class="small left" d="M0 0 L50 50 L0 33.3" fill="rgba(255,255,255, .5)"></path>
                <path class="small right" d="M100 0 L50 50 L100 33.3" fill="rgba(255,255,255, .5)"></path>

                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    
</footer>


    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://thapsang.net/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://thapsang.net/assets/js/scripts.min.js"></script>
<script type="text/javascript" src="http://thapsang.net/assets/js/waypoints.min.js"></script>
<script type="text/javascript" src="http://thapsang.net/assets/js/script.js"></script>
<script type='text/javascript'>$(document).ready(function(){$(".time").text(function(a,b){return Math.round(parseFloat(b))})});</script>

<script type="text/javascript">

/*      Slides       */

$("a#slide").click(function(){
    $("#sidebar,body,a#slide,#fade").addClass("slide")
});

$("#fade,#header,#posts-container").click(function(){
    $("#sidebar,body,a#slide,#fade").removeClass("slide")
});

$("a#click-filter").click(function(){
    $("#slide-filter").slideToggle("medium");
    $("#slide-pages").slideOut("medium");
});

$("a#click-pages").click(function(){
    $("#slide-pages").slideToggle("medium");
    $("#slide-filter").slideOut("medium");
});

/*      End-Slides      */

</script>


<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'http://thapsang.net/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55360781-1', 'auto');
  ga('send', 'pageview');

</script>


<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'thapsang'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 
</body>
</html>
