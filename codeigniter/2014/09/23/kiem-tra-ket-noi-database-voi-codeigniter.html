<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Kiểm tra kết nối database với CodeIgniter</title>
	
	<meta name="description" content="Cách thức kiểm tra kết nối tới database với CodeIgniter và cách xử lý lỗi.">
	
	<meta name="author" content="taly2808">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/taly2808">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/taly2808">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:taly2808@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="http://www.gravatar.com/avatar/726351295ec82e145928582f595aa3aa?s=35" class="img-circle" />
				
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<! -- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="/assets/avatar/my-candle.png" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/"></a>
    </h3>
</header>


<div id="bio" class="text-center">
	TaLy's blog
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/taly2808">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/taly2808">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
        
		<li>
			<a class="btn btn-default btn-sm" href="https://facebook.com/taly2808">
				<i class="fa fa-facebook fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
        
		<li>
			<a class="btn btn-default btn-sm" href="mailto:taly2808@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<! -- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Kiểm tra kết nối database với CodeIgniter </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   September 
	   23rd,
	     
	   2014
	 </span>
	  <div class="article_body">
	  <p>Tôi đang sử dụng CodeIgniter 2.2.0, Apache/2.4.9 (Unix), PHP/5.5.11, MySQL/5.0.1. Khi làm việc với database, tôi gặp phải thông báo lỗi sau:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="lineno">1</span> A Database Error Occurred
<span class="lineno">2</span> 
<span class="lineno">3</span> Unable to connect to your database server using the provided settings.
<span class="lineno">4</span> 
<span class="lineno">5</span> Filename: core/Loader.php
<span class="lineno">6</span> 
<span class="lineno">7</span> Line Number: 346</code></pre></div>

<p>Và đây là thông số cấu hình database trong <strong>/application/config/database.php</strong></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="x">$db[&#39;default&#39;][&#39;hostname&#39;] = &#39;localhost&#39;;</span>
<span class="lineno"> 2</span> <span class="x">$db[&#39;default&#39;][&#39;username&#39;] = &#39;root&#39;;</span>
<span class="lineno"> 3</span> <span class="x">$db[&#39;default&#39;][&#39;password&#39;] = &#39;mypasword&#39;;</span>
<span class="lineno"> 4</span> <span class="x">$db[&#39;default&#39;][&#39;database&#39;] = &#39;db_codeigniter_test&#39;;</span>
<span class="lineno"> 5</span> <span class="x">$db[&#39;default&#39;][&#39;dbdriver&#39;] = &#39;mysql&#39;;</span>
<span class="lineno"> 6</span> <span class="x">$db[&#39;default&#39;][&#39;dbprefix&#39;] = &#39;&#39;;</span>
<span class="lineno"> 7</span> <span class="x">$db[&#39;default&#39;][&#39;pconnect&#39;] = TRUE;</span>
<span class="lineno"> 8</span> <span class="x">$db[&#39;default&#39;][&#39;db_debug&#39;] = TRUE;</span>
<span class="lineno"> 9</span> <span class="x">$db[&#39;default&#39;][&#39;cache_on&#39;] = FALSE;</span>
<span class="lineno">10</span> <span class="x">$db[&#39;default&#39;][&#39;cachedir&#39;] = &#39;&#39;;</span>
<span class="lineno">11</span> <span class="x">$db[&#39;default&#39;][&#39;char_set&#39;] = &#39;utf8&#39;;</span>
<span class="lineno">12</span> <span class="x">$db[&#39;default&#39;][&#39;dbcollat&#39;] = &#39;utf8_general_ci&#39;;</span>
<span class="lineno">13</span> <span class="x">$db[&#39;default&#39;][&#39;swap_pre&#39;] = &#39;&#39;;</span>
<span class="lineno">14</span> <span class="x">$db[&#39;default&#39;][&#39;autoinit&#39;] = TRUE;</span>
<span class="lineno">15</span> <span class="x">$db[&#39;default&#39;][&#39;stricton&#39;] = FALSE;</span></code></pre></div>

<p>Để kiểm tra có kết nối được tới database hay không, ta cần thêm đoạn code sau phía dưới cùng của file <strong>/application/config/database.php</strong> và xem kết quả:</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="lineno"> 1</span> <span class="x">echo &#39;&lt;pre&gt;&#39;;</span>
<span class="lineno"> 2</span> <span class="x">print_r($db[&#39;default&#39;]);</span>
<span class="lineno"> 3</span> <span class="x">echo &#39;&lt;/pre&gt;&#39;;</span>
<span class="lineno"> 4</span> <span class="x">echo &#39;Connecting to database: &#39; .$db[&#39;default&#39;][&#39;database&#39;];</span>
<span class="lineno"> 5</span> <span class="x">  $dbh=mysql_connect(</span>
<span class="lineno"> 6</span> <span class="x">    $db[&#39;default&#39;][&#39;hostname&#39;],</span>
<span class="lineno"> 7</span> <span class="x">    $db[&#39;default&#39;][&#39;username&#39;],</span>
<span class="lineno"> 8</span> <span class="x">    $db[&#39;default&#39;][&#39;password&#39;])</span>
<span class="lineno"> 9</span> <span class="x">    or die(&#39;Cannot connect to the database because: &#39; . mysql_error());</span>
<span class="lineno">10</span> <span class="x">    mysql_select_db ($db[&#39;default&#39;][&#39;database&#39;]);</span>
<span class="lineno">11</span> 
<span class="lineno">12</span> <span class="x">    echo &#39;&lt;br /&gt;   Connected OK:&#39;  ;</span>
<span class="lineno">13</span> <span class="x">    die( &#39;file: &#39; .__FILE__ . &#39; Line: &#39; .__LINE__);</span></code></pre></div>

<p>Nếu bạn gặp cảnh báo <strong>The mysql extension is deprecated and will be removed in the future: use mysqli or PDO instead</strong>, để loại bỏ thông báo này, bạn có thể thêm <code>error_reporting(E_ALL ^ E_DEPRECATED);</code> vào đầu file <strong>/application/config/database.php</strong> hoặc chỉnh sửa giá trị của <strong>error_reporting</strong> trong file <strong>php.ini</strong>.
Xem thêm tại (http://stackoverflow.com/questions/13944956/the-mysql-extension-is-deprecated-and-will-be-removed-in-the-future-use-mysqli).</p>

<p>Nếu bạn gặp thông báo lỗi: <strong>mysql_connect(): No such file or directory</strong></p>

<p>Server không kết nối được tới database bởi vì file socket chưa chính xác. File socket của bạn có thể nằm ở /var/mysql/mysql.sock hoặc /tmp/mysql.sock (nếu bạn cài lampp hoặc xampp, nó sẽ là /opt/lampp/var/mysql/mysql.sock), tuy nhiên có thể PHP tìm kiếm sai vị trí.
Để giải quyết lỗi này, ta làm như sau:</p>

<ol>
  <li>Xem thông tin phpinfo(): nếu bạn cài lampp hoặc xampp thì có thể xem thông tin phpinfo() bằng cách nhập vào trình duyệt địa chỉ: <a href="http://localhost/xampp/phpinfo.php">http://localhost/xampp/phpinfo.php</a></li>
  <li>Tìm kiếm <strong>mysql.default_socket</strong> hoặc <strong>pdo_mysql.default_socket</strong>.</li>
  <li>Mở tập tin <strong>my.ini</strong> (nếu sử dụng xampp) hoặc <strong>my.cnf</strong> (nếu sử dụng lampp) và tìm kiếm giá trị của socket, ví dụ 	<strong>socket = /opt/lampp/var/mysql/mysql.sock</strong>.</li>
  <li>Mở tập tin <strong>php.ini</strong> (bạn có thể xem địa chỉ chứa file php.ini trên trang thông tin phpinfo hoặc sử dụng lệnh <em>locate php.ini</em>) và thay thế tất cả các địa chỉ không chính xác bằng địa chỉ chính xác từ MySQL.</li>
  <li>Restart Apache.</li>
</ol>

<p>Nguồn tham khảo: 
1. http://stackoverflow.com/questions/12584762/mysql-connect-no-such-file-or-directory
2. http://stackoverflow.com/questions/4219970/warning-mysql-connect-2002-no-such-file-or-directory-trying-to-connect-vi</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#codeigniter-ref">
					codeigniter <span>(1)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#database-ref">
					database <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#mysql-ref">
					mysql <span>(1)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Kiểm tra kết nối database với CodeIgniter&via=taly2808"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="http://www.gravatar.com/avatar/726351295ec82e145928582f595aa3aa" class="img-rounded author-image" />
        <h4 class="section-title author-name">taly2808</h4>
        <p class="author-bio">TaLy's blog</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/drupal-7/2014/04/14/tao-view-calendar-trong-drupal7.html" title="Tạo view calendar trong Drupal 7">&larr; Previous</a></li>
		  
		  
			<li class="next disabled"><a>Next &rarr;</a>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



		<footer>
			<hr/>
			<p>
				&copy; 2014 taly2808.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>

